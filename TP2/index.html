<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="style.css" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Facebook</title>
  </head>
  <body>
    <div class="container">
      <nav>
        <div class="left">
          <img src="./res/facebook.svg" />
          <div class="contentInput">
            <img src="./res/search.svg" alt="" srcset="" />
            <input type="text" placeholder="Rechercher sur Facebook" />
          </div>
        </div>
        <div class="center">
          <div class="home">
            <img src="./res/home.svg" alt="" srcset="" />
          </div>
          <div class="ami">
            <img src="./res/groupe.svg" alt="" srcset="" />
          </div>
          <div class="groupe">
            <img src="./res/groupes.svg" alt="" srcset="" />
          </div>
        </div>
        <div class="Right">
          <div class="contentInput">
            <input type="text" placeholder="retrouver les amis sur Facebook" />
          </div>
          <div class="home">
            <img src="./res/braille.svg" alt="" srcset="" class="imga" />
          </div>
          <div class="home">
            <img src="./res/msg.svg" alt="" srcset="" class="imga" />
          </div>
          <div class="home">
            <span>2</span>
            <img src="./res/bells.svg" alt="" srcset="" class="imga" />
          </div>
          <div class="home">
            <img
              src="./res/profil.jpg"
              alt=""
              srcset=""
              class="profil"
              id="profil-picture"
            />
          </div>
          <div class="home">
            <button onclick="logout()">Se Déconnecter</button>
          </div>
        </div>
      </nav>
      <main id="main">
        <div class="element">
          <div class="header">
            <div class="storie">
              <img src="./res/book-open.svg" alt="" />
            </div>
            <div class="video">
              <img src="./res/clapperboard-play.svg" alt="" />
            </div>
          </div>
          <div class="body">
            <div class="left">
              <div class="container">
                <img src="./res/profil.jpg" alt="" id="profil-picture" />
                <span>+</span>
                <div class="end">
                  <span> Crée une Story </span>
                </div>
              </div>
            </div>
            <div class="rigth">
              <div class="content">
                <img src="./res/heart.svg" alt="" />
                <span
                  >Partagez des moments du quotidien avec vos amis et votre
                  famille.</span
                >
              </div>
              <div class="content">
                <img src="./res/stopwatch.svg" alt="" />
                <span>Les stories disparaissent après 24 heures.</span>
              </div>
              <div class="content">
                <img src="./res/msg.svg" alt="" />
                <span>Les réponses et les réactions sont privées.</span>
              </div>
            </div>
          </div>
        </div>

        <!-- </div>
         <div class="element"></div>
        <div class="element"></div>
        <div class="element"></div>
        <div class="element"></div>
        <div class="element"></div> -->
      </main>
      <div class="sidebar">
        <div class="bodyItem">
          <div class="itemContent">
            <div class="item">
              <img
                src="./res/profil.jpg"
                alt=""
                srcset=""
                class="profil"
                id="profil-picture"
              />
              <h3>Honorine HTH</h3>
            </div>
          </div>
          <div class="itemContent">
            <div class="item">
              <img src="./res/groupe.svg" alt="" srcset="" class="icon" />
              <h3>Retrouver des amis</h3>
            </div>
          </div>
          <div class="itemContent">
            <div class="item">
              <img
                src="./res/presentation-screen.svg"
                alt=""
                srcset=""
                class="icon"
              />
              <h3>Plus récentes</h3>
            </div>
          </div>
          <div class="itemContent">
            <div class="item">
              <img src="./res/facebook.svg" alt="" srcset="" class="icon" />
              <h3>Bienvenue</h3>
            </div>
          </div>
          <div class="itemContent">
            <div class="item">
              <img src="./res/groupes.svg" alt="" srcset="" class="icon" />
              <h3>Groupes</h3>
            </div>
          </div>
          <div class="itemContent">
            <div class="item">
              <img src="./res/shop.svg" alt="" srcset="" class="icon" />
              <h3>Marketplace</h3>
            </div>
          </div>
          <div class="itemContent">
            <div class="item">
              <img
                src="./res/clapperboard-play.svg"
                alt=""
                srcset=""
                class="icon"
              />
              <h3>Watch</h3>
            </div>
          </div>
          <div class="itemContent">
            <div class="item">
              <img src="./res/stopwatch.svg" alt="" srcset="" class="icon" />
              <h3>Souvenirs</h3>
            </div>
          </div>
          <div class="itemContent">
            <div class="item">
              <img src="./res/bookmark.svg" alt="" srcset="" class="icon" />
              <h3>Enregistrements</h3>
            </div>
          </div>
          <div class="itemContent">
            <div class="item">
              <img src="./res/flag.svg" alt="" srcset="" class="icon" />
              <h3>Pages</h3>
            </div>
          </div>
          <div class="itemContent">
            <div class="item">
              <img src="./res/calendar.svg" alt="" srcset="" class="icon" />
              <h3>Evénements</h3>
            </div>
          </div>
          <div class="itemContent">
            <div class="item">
              <img
                src="./res/arrow-circle-down.svg"
                alt=""
                srcset=""
                class="icon"
              />
              <h3>Voir plus</h3>
            </div>
          </div>
        </div>
        <div class="apropos">
          ·<a href="#"> Confidentialité </a> .<a href="#">
            Conditions générales
          </a>
          .<a href="#"> Publicités </a> .<a href="#"> Choix publicitaires </a>
          .<a href="#"> Cookies </a>
          <a href="#"> · Gl3A © 2023 </a>
        </div>
      </div>
      <footer>
        <h3>Conversations de groupe</h3>
        <div class="creategroup">
          <img src="./res/plus.svg" />
          <span> Cree un nouveau groupe </span>
        </div>
      </footer>
    </div>
  </body>
  <script>
    init();
    function init() {
      var userJSON = localStorage.getItem("logged");
      var user = JSON.parse(userJSON);
      const item = document.querySelectorAll("#profil-picture");
      item.forEach((it) => {
        it.src = user.profil;
      });
    }
    getFeeds();
    function getFeeds() {
      var userJSON = localStorage.getItem("logged");

      // // Vérifier si la chaîne JSON existe
      if (userJSON) {
        //   // Convertir la chaîne JSON en objet
        var user = JSON.parse(userJSON);
        const queryString = new URLSearchParams(user).toString();
        const url = `http://localhost:8000/feed?${queryString}`;

        fetch(url, {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
          },
        })
          .then((response) => response.json())
          .then((data) => {
            // Traiter la réponse de la requête
            const container = document.getElementById("main");
            console.log(data);
            data.feed.forEach((item) => {
              // Créer un nouvel élément div pour chaque élément de la liste
              const element = document.createElement("div");
              element.classList.add("element");

              // Effectuer le rendu des autres éléments à l'intérieur de l'élément div
              element.innerHTML = `
        <div class="post-header">
          <img src="${item.profil}" />
          <div class="end">${item.username}</div>
        </div>
        <div class="divider"></div>
        <div class="post-body">
          <p class="post-text">${item.text}</p>
          <img src="${item.image}" class="post-image" />
        </div>
        <div class="post-footer">
          <div class="like">LIKE ${item.likes}</div>
        </div>
      `;

              // Ajouter l'élément div au conteneur parent
              container.appendChild(element);
            });
          })
          .catch((error) => {
            // Gérer les erreurs de la requête
            console.log(error);
            // alert("Nom ou mot de passe incorrect");
          });
      } else {
        window.location.href = "login/login.html";
      }
    }
    function logout() {
      var userJSON = localStorage.getItem("logged");

      var user = JSON.parse(userJSON);

      const url = "http://localhost:8000/logout";

      fetch(url, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(user),
      })
        .then((response) => response.json())
        .then((data) => {
          console.log(data);
          localStorage.removeItem("logged");
          window.location.href = "login/login.html";
        })
        .catch((error) => {
          // Gérer les erreurs de la requête
          console.log(error);
          // alert("Nom ou mot de passe incorrect");
          // <a href="https://imgbb.com/"><img src="https://i.ibb.co/YywB5hp/carde.png" alt="carde" border="0"></a><br /><a target='_blank' href='https://whatsmyscreenresolution.com/'>how to find out how many pixels your screen is</a><br />
        });
    }
  </script>
</html>
